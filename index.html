<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Upside Down: Telekinesis</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #050000; overflow: hidden; font-family: 'serif'; }
        
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, #1a0000, #000);
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; z-index: 1000; color: #ff0000;
        }

        #start-btn {
            padding: 15px 40px; font-size: 20px; color: #ff0000; background: transparent;
            border: 2px solid #ff0000; cursor: pointer; text-transform: uppercase;
            letter-spacing: 5px; box-shadow: 0 0 20px #500;
        }

        #status-ui {
            position: absolute; top: 20px; left: 20px; color: #ff3333;
            font-size: 14px; text-shadow: 0 0 10px #f00; z-index: 10;
        }

        #webcam-preview {
            position: absolute; bottom: 20px; right: 20px; width: 120px; 
            border: 1px solid #300; opacity: 0.4; transform: scaleX(-1);
        }

        /* Red Vignette Effect */
        body::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            box-shadow: inset 0 0 200px rgba(255,0,0,0.3); pointer-events: none; z-index: 5;
        }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 style="letter-spacing:15px; text-shadow: 0 0 20px #f00;">THE UPSIDE DOWN</h1>
        <button id="start-btn">ENTER THE VOID</button>
        <p style="margin-top:20px; font-size:12px; opacity:0.6;">USE YOUR HANDS TO CONTROL REALITY</p>
    </div>

    <div id="status-ui">BRAIN LINK: WAITING...</div>
    <video id="webcam-preview" autoplay playsinline></video>
    <div id="container"></div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        const videoElement = document.getElementById('webcam-preview');
        const startBtn = document.getElementById('start-btn');
        const statusUI = document.getElementById('status-ui');
        
        let scene, camera, renderer, objectToControl, ashParticles;
        let isCrushing = false;

        function initUpsideDown() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050000, 0.015); // Stranger Things Fog

            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 30);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('container').appendChild(renderer.domElement);

            // Red & Blue Moody Lights
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);
            const redLight = new THREE.PointLight(0xff0000, 2, 100);
            redLight.position.set(10, 10, 10);
            scene.add(redLight);

            // Floating Ash Particles
            const ashGeo = new THREE.BufferGeometry();
            const ashCount = 3000;
            const ashPos = new Float32Array(ashCount * 3);
            for(let i=0; i<ashCount*3; i++) ashPos[i] = (Math.random() - 0.5) * 100;
            ashGeo.setAttribute('position', new THREE.BufferAttribute(ashPos, 3));
            const ashMat = new THREE.PointsMaterial({ color: 0x888888, size: 0.1, transparent: true, opacity: 0.5 });
            ashParticles = new THREE.Points(ashGeo, ashMat);
            scene.add(ashParticles);

            // The Object we will control (Floating Core)
            const objGeo = new THREE.IcosahedronGeometry(4, 0);
            const objMat = new THREE.MeshPhongMaterial({ color: 0x111111, wireframe: true, emissive: 0x330000 });
            objectToControl = new THREE.Mesh(objGeo, objMat);
            objectToControl.position.y = 5;
            scene.add(objectToControl);

            // Floor Grid (Vines feel)
            const grid = new THREE.GridHelper(200, 40, 0x330000, 0x110000);
            scene.add(grid);
        }

        const hands = new Hands({ locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}` });
        hands.setOptions({ maxNumHands: 1, minDetectionConfidence: 0.7 });
        
        hands.onResults((results) => {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const marks = results.multiHandLandmarks[0];
                const index = marks[8];
                const thumb = marks[4];

                // Telekinesis Movement
                const tx = (index.x - 0.5) * -50;
                const ty = (index.y - 0.5) * -30 + 10;
                
                // Move object towards hand position
                objectToControl.position.x += (tx - objectToControl.position.x) * 0.1;
                objectToControl.position.y += (ty - objectToControl.position.y) * 0.1;

                // Detect Gestures
                const distance = Math.hypot(index.x - thumb.x, index.y - thumb.y);
                const isFist = marks[8].y > marks[6].y && marks[12].y > marks[10].y;

                if (isFist) { // ðŸ‘Š CRUSH
                    statusUI.innerText = "BRAIN LINK: CRUSHING OBJECT";
                    objectToControl.scale.lerp(new THREE.Vector3(0.2, 0.2, 0.2), 0.1);
                    objectToControl.rotation.x += 0.5;
                } else if (distance < 0.05) { // ðŸ‘Œ PINCH / HOLD
                    statusUI.innerText = "BRAIN LINK: OBJECT SECURED";
                    objectToControl.scale.lerp(new THREE.Vector3(1.2, 1.2, 1.2), 0.1);
                    objectToControl.rotation.y += 0.1;
                } else { // ðŸ–ï¸ OPEN PALM
                    statusUI.innerText = "BRAIN LINK: STABLE";
                    objectToControl.scale.lerp(new THREE.Vector3(1, 1, 1), 0.05);
                }
            }
        });

        const cam = new Camera(videoElement, {
            onFrame: async () => { await hands.send({image: videoElement}); },
            width: 640, height: 480
        });

        startBtn.onclick = async () => {
            document.getElementById('overlay').style.display = 'none';
            initUpsideDown();
            await cam.start();
            
            function animate() {
                requestAnimationFrame(animate);
                // Float Ash
                ashParticles.position.y -= 0.02;
                if(ashParticles.position.y < -20) ashParticles.position.y = 20;
                
                objectToControl.rotation.z += 0.01;
                renderer.render(scene, camera);
            }
            animate();
        };
    </script>
</body>
</html>
